<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Nexus Ultra - Remapper</title>
    <link href="global.css" rel="stylesheet"/>
    <style>
        .mouse-vis { position: relative; height: 320px; display: flex; align-items: center; justify-content: center; background: radial-gradient(circle, rgba(19, 127, 236, 0.08) 0%, transparent 70%); }
        .mouse-body { width: 140px; height: 230px; border: 4px solid #1e293b; border-radius: 60px; background: #0f172a; position: relative; box-shadow: 0 15px 50px rgba(0,0,0,0.6); }
        .wheel { width: 4px; height: 40px; background: rgba(19,127,236,0.3); border-radius: 10px; margin: 25px auto 0 auto; transition: 0.3s; }
        .btn-side { position: absolute; left: -2px; width: 6px; height: 40px; background: #334155; border-radius: 0 4px 4px 0; transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1); }
        .btn-side.active { background: var(--primary); box-shadow: 0 0 20px var(--primary); width: 10px; }
        #side4 { top: 85px; }
        #side5 { top: 135px; }
        .status-center { position: absolute; bottom: 40px; text-align: center; width: 100%; }
        .hz-val { font-size: 1.4rem; font-weight: 900; color: var(--primary); display: block; text-shadow: 0 0 15px var(--primary-glow); }
        .hz-label { font-size: 0.6rem; color: var(--text-dim); text-transform: uppercase; letter-spacing: 0.2em; font-weight: 800; }
        .input-group { position: relative; display: flex; gap: 8px; align-items: center; }
        .browse-btn { padding: 9px; background: var(--input-dark); border: 1px solid rgba(255,255,255,0.08); border-radius: 8px; cursor: pointer; color: var(--text-dim); transition: 0.2s; }
        .browse-btn:hover { color: var(--primary); border-color: var(--primary); background: rgba(19,127,236,0.1); }
    </style>
</head>
<body>
    <header>
        <div class="header-title">
            <svg style="width:24px; height:24px; fill:var(--primary)" viewBox="0 0 24 24"><path d="M13 1.07V9h7c0-4.08-3.05-7.44-7-7.93zM4 15c0 4.42 3.58 8 8 8s8-3.58 8-8v-4H4v4zm7-13.93C7.05 1.56 4 4.92 4 9h7V1.07z"/></svg>
            <h1>Nexus Ultra</h1>
        </div>
        <div class="status-badge">
            <div class="status-point"></div>
            <span style="font-size: 0.65rem; font-weight: 900; color: var(--primary); text-transform: uppercase;">Engine Live</span>
        </div>
    </header>

    <main style="padding: 24px;">
        <div class="mouse-vis">
            <div class="mouse-body">
                <div class="wheel"></div>
                <div id="side4" class="btn-side"></div>
                <div id="side5" class="btn-side"></div>
                <div class="status-center">
                    <span id="hzDisplay" class="hz-val">0 HZ</span>
                    <span class="hz-label">Polling Rate</span>
                </div>
            </div>
        </div>

        <section style="margin-top: 10px;">
            <div class="card" style="margin-bottom: 12px;">
                <label class="section-label" style="margin-top:0; margin-bottom: 8px; font-size: 0.6rem;">Button 4 (Forward)</label>
                <div style="display: grid; grid-template-columns: 120px 1fr; gap: 12px;">
                    <select id="type4">
                        <option value="none">Disabled</option>
                        <option value="keys">Key Combo</option>
                        <option value="run">Run Script</option>
                        <option value="open">Open App</option>
                        <option value="text">Text Snippet</option>
                        <option value="macro">Macro Sequence</option>
                    </select>
                    <div class="input-group">
                        <input id="val4" type="text" placeholder="Value, Path or Macro String..."/>
                        <button class="browse-btn" onclick="browse(4)" title="Choose Application">
                            <svg style="width: 16px; height: 16px; fill: currentColor;" viewBox="0 0 24 24"><path d="M20 6h-8l-2-2H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2h-8l-2-2z"/></svg>
                        </button>
                    </div>
                </div>
            </div>

            <div class="card">
                <label class="section-label" style="margin-top:0; margin-bottom: 8px; font-size: 0.6rem;">Button 5 (Backward)</label>
                <div style="display: grid; grid-template-columns: 120px 1fr; gap: 12px;">
                    <select id="type5">
                        <option value="none">Disabled</option>
                        <option value="keys">Key Combo</option>
                        <option value="run">Run Script</option>
                        <option value="open">Open App</option>
                        <option value="text">Text Snippet</option>
                        <option value="macro">Macro Sequence</option>
                    </select>
                    <div class="input-group">
                        <input id="val5" type="text" placeholder="Value, Path or Macro String..."/>
                        <button class="browse-btn" onclick="browse(5)" title="Choose Application">
                            <svg style="width: 16px; height: 16px; fill: currentColor;" viewBox="0 0 24 24"><path d="M20 6h-8l-2-2H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2h-8l-2-2z"/></svg>
                        </button>
                    </div>
                </div>
            </div>
        </section>

        <button id="saveBtn" class="btn-primary" style="margin-top: 20px; font-weight: 800; letter-spacing: 0.05em;">
            <svg style="width: 18px; fill: white;" viewBox="0 0 24 24"><path d="M17 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V7l-4-4zm-5 16c-1.66 0-3-1.34-3-3s1.34-3 3-3 3 1.34 3 3-1.34 3-3 3zm3-10H5V5h10v4z"/></svg>
            APPLY CONFIGURATION
        </button>
    </main>

    <nav class="nav-bar">
        <a href="profiles.html" class="nav-item">
            <svg viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 3c1.66 0 3 1.34 3 3s-1.34 3-3 3-3-1.34-3-3 1.34-3 3-3zm0 14.2c-2.5 0-4.71-1.28-6-3.22.03-1.99 4-3.08 6-3.08s5.97 1.09 6 3.08c-1.29 1.94-3.5 3.22-6 3.22z"/></svg>
            Profiles
        </a>
        <a href="remapper.html" class="nav-item active">
            <svg viewBox="0 0 24 24"><path d="M13 1.07V9h7c0-4.08-3.05-7.44-7-7.93zM4 15c0 4.42 3.58 8 8 8s8-3.58 8-8v-4H4v4zm7-13.93C7.05 1.56 4 4.92 4 9h7V1.07z"/></svg>
            Remap
        </a>
        <a href="macro_recorder.html" class="nav-item">
            <svg viewBox="0 0 24 24"><path d="M3 13h12v-2H3v2zm0 4h12v-2H3v2zm0-8h12V7H3v2zm14 8l5-5-5-5v10z"/></svg>
            Macros
        </a>
        <a href="settings.html" class="nav-item">
            <svg viewBox="0 0 24 24"><path d="M19.14 12.94c.04-.3.06-.61.06-.94 0-.32-.02-.64-.07-.94l2.03-1.58c.18-.14.23-.41.12-.61l-1.92-3.32c-.12-.22-.37-.29-.59-.22l-2.39.96c-.5-.38-1.03-.7-1.62-.94l-.36-2.54c-.04-.24-.24-.41-.48-.41h-3.84c-.24 0-.43.17-.47.41l-.36 2.54c-.59.24-1.13.57-1.62.94l-2.39-.96c-.22-.08-.47 0-.59.22L2.74 8.87c-.12.21-.08.47.12.61l2.03 1.58c-.05.3-.09.63-.09.94s.02.64.07.94l-2.03 1.58c-.18.14-.23.41-.12.61l1.92 3.32c.12.22.37.29.59.22l2.39-.96c.5.38 1.03.7 1.62.94l.36 2.54c.05.24.24.41.48.41h3.84c.24 0 .44-.17.47-.41l.36-2.54c.59-.24 1.13-.56 1.62-.94l2.39.96c.22.08.47 0 .59-.22l1.92-3.32c.12-.22.07-.47-.12-.61l-2.01-1.58zM12 15.6c-1.98 0-3.6-1.62-3.6-3.6s1.62-3.6 3.6-3.6 3.6 1.62 3.6 3.6-1.62 3.6-3.6 3.6z"/></svg>
            Settings
        </a>
    </nav>

    <script>
        const API = "http://127.0.0.1:48621";

        async function load() {
            try {
                const res = await fetch(`${API}/config`);
                const data = await res.json();
                
                const b4 = parse(data.button4);
                const b5 = parse(data.button5);

                document.getElementById('type4').value = b4.t;
                document.getElementById('val4').value = b4.v;
                document.getElementById('type5').value = b5.t;
                document.getElementById('val5').value = b5.v;
            } catch(e) {}
        }

        function parse(s) {
            if(!s) return {t:'none', v:''};
            const i = s.indexOf(':');
            if(i===-1) return {t:s.toLowerCase(), v:''};
            return {t: s.slice(0,i).toLowerCase(), v: s.slice(i+1)};
        }

        async function save() {
            const btn = document.getElementById('saveBtn');
            const old = btn.innerHTML;
            btn.innerHTML = "APPLYING...";

            const cfg = {
                button4: document.getElementById('type4').value + ":" + document.getElementById('val4').value,
                button5: document.getElementById('type5').value + ":" + document.getElementById('val5').value
            };

            try {
                await fetch(`${API}/config`, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify(cfg)
                });
                btn.innerHTML = "CONFIGURATION SAVED!";
                setTimeout(() => btn.innerHTML = old, 1500);
            } catch(e) {
                btn.innerHTML = "ERROR";
                setTimeout(() => btn.innerHTML = old, 1500);
            }
        }

        async function browse(btnNum) {
            try {
                const res = await fetch(`${API}/browse`);
                const data = await res.json();
                if(data.ok && data.path) {
                    document.getElementById('val' + btnNum).value = data.path;
                    document.getElementById('type' + btnNum).value = 'open';
                }
            } catch(e) {}
        }

        async function telemetry() {
            try {
                const res = await fetch(`${API}/status`);
                const data = await res.json();
                document.getElementById('hzDisplay').textContent = `${data.poll_rate_hz || 0} HZ`;
                
                if(data.poll_rate_hz > 5) {
                    document.getElementById('side4').classList.toggle('active', Math.random() > 0.9);
                    document.getElementById('side5').classList.toggle('active', Math.random() > 0.9);
                    document.querySelector('.wheel').style.marginTop = "28px";
                    setTimeout(()=> { document.querySelector('.wheel').style.marginTop = "25px"; }, 100);
                } else {
                    document.getElementById('side4').classList.remove('active');
                    document.getElementById('side5').classList.remove('active');
                }
            } catch(e) {}
        }

        document.getElementById('saveBtn').onclick = save;
        setInterval(telemetry, 300);
        load();
    </script>
</body>
</html>
